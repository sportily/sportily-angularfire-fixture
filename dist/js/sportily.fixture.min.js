(function(){var a;a=angular.module("sportily.fixture",["sportily.fixture.filters","sportily.fixture.service","sportily.fixture.templates"]),a.directive("sportilyFixture",["Fixture",function(a){return{restrict:"A",scope:!0,link:function(b,c,d){return d.sportilyFixture?b.fixture=a(d.sportilyFixture):void 0}}}]),a.directive("sportilyTimeline",function(){return{restrict:"E",require:"^sportilyFixture",templateUrl:"templates/sportily/fixture/timeline.html"}}),a.directive("sportilyScores",function(){return{restrict:"E",require:"^sportilyFixture",templateUrl:"templates/sportily/fixture/scores.html"}})}).call(this),function(){var a;a=angular.module("sportily.fixture.events",["firebase"]),a.factory("LiveEvents",["$firebaseArray",function(a){return function(b){var c,d;return c="https://blistering-fire-4761.firebaseio.com/fixtures/",d=new Firebase(c+b+"/events"),a(d)}}])}.call(this),function(){var a,b,c;a=angular.module("sportily.fixture.filters",[]),c=function(a){return a.charAt(0).toUpperCase()+a.slice(1).toLowerCase()},b=function(a,c,d){return a.length>=d?a:b(c+a,c,d)},a.filter("person",function(){return function(a){return c(a.given_name)+" "+c(a.family_name)}}),a.filter("gameTime",function(){return function(a){var c,d,e,f,g;return c=moment.duration(a),d=""+c.hours(),e=""+c.minutes(),f=""+c.seconds(),g=b(e,"0",2)+":"+b(f,"0",2),c.hours()>0&&(g=d+":"+g),g}}),a.filter("reverse",function(){return function(a){return a?a.slice().reverse():void 0}})}.call(this),function(){var a;a=angular.module("sportily.fixture.service",["sportily.api","sportily.fixture.events","sportily.fixture.state"]),a.factory("Fixture",["Fixtures","Participants","FixtureState","LiveEvents","$q",function(a,b,c,d,e){var f;return f=function(){function f(a){var b,c;this.id=a,b=this._initDetails(),c=this._initParticipants(),e.all([b,c]).then(function(a){return function(){return a._initEvents()}}(this))}return f.prototype._initDetails=function(){return a.one(this.id).get().then(function(a){return function(b){return a.details=b}}(this))},f.prototype._initParticipants=function(){return b.getList({fixture_id:this.id}).then(function(a){return function(b){return a.participants=b}}(this))},f.prototype._initEvents=function(){return this.events=d(this.id),this.events.$loaded(function(a){return function(){return a._initState()}}(this))},f.prototype._initState=function(){return this.state=c(this),this.state.update()},f}(),function(a){return new f(a)}}])}.call(this),function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}};a=angular.module("sportily.fixture.state",[]),a.factory("FixtureState",["$interval",function(a){var c;return c=function(){function c(a){this.fixture=a,this._updateGameTime=b(this._updateGameTime,this),this.fixture.events.$watch(function(a){return function(){return a.update()}}(this))}return c.prototype.update=function(){var a,b,c;return this.inProgress=!1,this.started=!1,this.startedAt=null,this.finished=!1,this.paused=!1,this.pausedAt=null,this.pausedFor=0,this.gameTime=null,this.scores={home:0,away:0},c={},a=null,b=!1,this.fixture.events.forEach(function(a){return function(d){var e,f;switch(c[d.id]=d,e=moment(d.happened_at),b=d.entry_id===a.fixture.details.home_entry.division_entry_id,d.type){case"game_start":a.started=!0,a.startedAt=e,a._startTimer();break;case"game_finish":a.finished=!0,a.paused=!0,a._stopTimer();break;case"game_pause":a.paused=!0,a.pausedAt=e,a._stopTimer();break;case"game_resume":a.paused=!1,a.pausedFor+=e.diff(a.pausedAt),a.pausedAt=null,a._startTimer();break;case"goal":b?a.scores.home++:a.scores.away++;break;case"own_goal":b?a.scores.away++:a.scores.home++}return d.game_time=e.diff(a.startedAt)-a.pausedFor,d.scores={home:a.scores.home,away:a.scores.away},d.parent_id?(f=c[d.parent_id],f.childre||(f.children=[]),f.children.push(d)):void 0}}(this)),this.inProgress=this.started&&!this.finished,this._updateGameTime()},c.prototype._updateGameTime=function(){var a,b,c,d;return b=null!=(c=this.pausedAt)?c:moment(),this.gameTime=b.diff(this.startedAt)-this.pausedFor,d=this.fixture.events,a=d[d.length-1],null!=a?this.gameTime=Math.max(this.gameTime,a.game_time):void 0},c.prototype._startTimer=function(){return this.timer?void 0:this.timer=a(this._updateGameTime,500)},c.prototype._stopTimer=function(){return this.timer&&a.cancel(this.timer),this.timer=void 0},c}(),function(a){return new c(a)}}])}.call(this),angular.module("sportily.fixture.templates",["templates/sportily/fixture/scores.html","templates/sportily/fixture/timeline.html","templates/sportily/fixture/timeline/assist.html","templates/sportily/fixture/timeline/foul.html","templates/sportily/fixture/timeline/game_finish.html","templates/sportily/fixture/timeline/game_pause.html","templates/sportily/fixture/timeline/game_resume.html","templates/sportily/fixture/timeline/game_start.html","templates/sportily/fixture/timeline/goal.html","templates/sportily/fixture/timeline/own_goal.html"]),angular.module("templates/sportily/fixture/scores.html",[]).run(["$templateCache",function(a){a.put("templates/sportily/fixture/scores.html",'<span class="sportily-scores">\n    <span class="sportily-scores__home">{{ fixture.state.scores.home }}</span>\n    <span class="sportily-scores__vs">–</span>\n    <span class="sportily-scores__home">{{ fixture.state.scores.away }}</span>\n<span>\n')}]),angular.module("templates/sportily/fixture/timeline.html",[]).run(["$templateCache",function(a){a.put("templates/sportily/fixture/timeline.html",'<ul class="timeline">\n    <li class="timeline__item" ng-if="fixture.state.inProgress">\n        <div class="event event--flow">{{ fixture.state.gameTime | gameTime }}</div>\n    </li>\n    <li class="timeline__item"\n        ng-repeat="event in fixture.events | reverse"\n        ng-include="\'templates/sportily/fixture/timeline/\' + event.type + \'.html\'">\n    </li>\n</ul>\n')}]),angular.module("templates/sportily/fixture/timeline/assist.html",[]).run(["$templateCache",function(a){a.put("templates/sportily/fixture/timeline/assist.html","")}]),angular.module("templates/sportily/fixture/timeline/foul.html",[]).run(["$templateCache",function(a){a.put("templates/sportily/fixture/timeline/foul.html",'<div class="event event--foul"\n    ng-class="{ \'event--home\' : event.entry_id == fixture.details.home_entry.division_entry_id }">\n    <div class="event__icon"><i class="fa fa-thumbs-down"></i></div>\n    <div class="event__panel">\n        <div class="event__time">{{:: event.game_time | gameTime }}</div>\n        <div class="event__description">\n            <span ng-if="event.participant_id">\n                Foul committed by {{:: fixture.participants.lookup[event.participant_id].name | person }}\n            </span>\n            <span ng-if="!event.participant_id">\n                Bench Penalty!\n            </span>\n        </div>\n        <div class="event__aux" ng-if="event.penalty_seconds">\n            Awarded {{:: event.penalty_seconds / 60 }} penalty minutes\n        </div>\n        <div class="event__notes" ng-if="event.notes">\n            “{{:: event.notes }}”\n        </div>\n    </div>\n</div>\n')}]),angular.module("templates/sportily/fixture/timeline/game_finish.html",[]).run(["$templateCache",function(a){a.put("templates/sportily/fixture/timeline/game_finish.html",'<div class="event event--flow">Full-time</div>\n')}]),angular.module("templates/sportily/fixture/timeline/game_pause.html",[]).run(["$templateCache",function(a){a.put("templates/sportily/fixture/timeline/game_pause.html","")}]),angular.module("templates/sportily/fixture/timeline/game_resume.html",[]).run(["$templateCache",function(a){a.put("templates/sportily/fixture/timeline/game_resume.html","")}]),angular.module("templates/sportily/fixture/timeline/game_start.html",[]).run(["$templateCache",function(a){a.put("templates/sportily/fixture/timeline/game_start.html",'<div class="event event--flow">Face-off</div>\n')}]),angular.module("templates/sportily/fixture/timeline/goal.html",[]).run(["$templateCache",function(a){a.put("templates/sportily/fixture/timeline/goal.html",'<div class="event event--goal"\n    ng-class="{ \'event--home\' : event.entry_id == fixture.details.home_entry.division_entry_id }">\n    <div class="event__icon"><i class="fa fa-star"></i></div>\n    <div class="event__panel">\n        <div class="event__time">{{:: event.game_time | gameTime }}</div>\n        <div class="event__description">\n            <strong>{{:: event.scores.home }} – {{:: event.scores.away }}:</strong>\n            Goal scored by {{:: fixture.participants.lookup[event.participant_id].name | person }}\n        </div>\n        <div class="event__aux" ng-if="event.children">\n            Assisted by\n            <span ng-repeat="child in event.children">{{ $first ? \'\' : $last ? \' and \' : \', \' }}{{:: fixture.participants.lookup[child.participant_id].name | person }}</span>\n        </div>\n        <div class="event__notes" ng-if="event.notes">\n            “{{:: event.notes }}”\n        </div>\n    </div>\n</div>\n')}]),angular.module("templates/sportily/fixture/timeline/own_goal.html",[]).run(["$templateCache",function(a){a.put("templates/sportily/fixture/timeline/own_goal.html",'<div class="event event--own_goal"\n    ng-class="{ \'event--home\' : event.entry_id != fixture.details.home_entry.division_entry_id }">\n    <div class="event__icon"><i class="fa fa-star"></i></div>\n    <div class="event__panel">\n        <div class="event__time">{{:: event.game_time | gameTime }}</div>\n        <div class="event__description">\n            <strong>{{:: event.scores.home }} – {{:: event.scores.away }}:</strong>\n            Own Goal!\n        </div>\n        <div class="event__notes" ng-if="event.notes">\n            “{{:: event.notes }}”\n        </div>\n    </div>\n</div>\n')}]);
//# sourceMappingURL=sportily.fixture.min.js.map